# Â© Copyright IBM Corporation 2025
# SPDX-License-Identifier: Apache-2.0


defaults:
  terratorch_task:
    model_args:
      backbone: prithvi_eo_v2_300
      backbone_pretrained: true
    model_factory: EncoderDecoderFactory
    optimizer: AdamW
  trainer_args:
    accelerator: gpu
    log_every_n_steps: 1
    logger:
      class_path: lightning.pytorch.loggers.mlflow.MLFlowLogger
      init_args:
        experiment_name: geotune-qokd9fqyuhxbgyyiuurpxu
        run_name: prithvi-eo2-burnscars
        save_dir: /geotunes/tune-tasks/geotune-qokd9fqyuhxbgyyiuurpxu/mlflow
        tracking_uri: https://geofm-mlflow-geospatial.apps.fmaas-devstage-backend.fmaas.res.ibm.com/
    max_epochs: 4
experiment_name: geotune-qokd9fqyuhxbgyyiuurpxu
n_trials: 4
optimization_space:
  lr:
    log: true
    max: 1e-3
    min: 1e-6
    type: real
  optimizer_hparams:
    weight_decay:
      max: 0.4
      min: 0
      type: real
run_repetitions: 1
save_models: false
storage_uri: /geotunes/tune-tasks/geotune-qokd9fqyuhxbgyyiuurpxu/
tasks:
- datamodule:
    class_path: terratorch.datamodules.GenericNonGeoSegmentationDataModule
    init_args:
      batch_size: 4
      constant_scale: 1.0
      dataset_bands:
      - 0
      - 1
      - 2
      - 3
      - 4
      - 5
      img_grep: '*_merged.tif'
      label_grep: '*.mask.tif'
      means:
      - 0.052501344674454685
      - 0.07818710276892571
      - 0.09527748749364956
      - 0.21442636938609524
      - 0.23594506038412516
      - 0.1707575734110789
      no_data_replace: 0
      no_label_replace: -1
      num_classes: 3
      num_workers: 2
      output_bands:
      - 0
      - 1
      - 2
      - 3
      - 4
      - 5
      rgb_indices:
      - 0
      - 1
      - 2
      stds:
      - 0.02980933467336373
      - 0.03671671799312583
      - 0.054445047276513434
      - 0.06953507438690602
      - 0.09133826565407105
      - 0.08313280812483531
      test_data_root: /data/geodata-r8sa4rfthfs9pnqaxxdvra/training_data/HLS_L30/
      test_label_data_root: /data/geodata-r8sa4rfthfs9pnqaxxdvra/labels/
      test_split: /data/geodata-r8sa4rfthfs9pnqaxxdvra/split_files/test_data.txt
      test_transform:
      - class_path: ToTensorV2
      train_data_root: /data/geodata-r8sa4rfthfs9pnqaxxdvra/training_data/HLS_L30/
      train_label_data_root: /data/geodata-r8sa4rfthfs9pnqaxxdvra/labels/
      train_split: /data/geodata-r8sa4rfthfs9pnqaxxdvra/split_files/train_data.txt
      val_data_root: /data/geodata-r8sa4rfthfs9pnqaxxdvra/training_data/HLS_L30/
      val_label_data_root: /data/geodata-r8sa4rfthfs9pnqaxxdvra/labels/
      val_split: /data/geodata-r8sa4rfthfs9pnqaxxdvra/split_files/val_data.txt
  direction: max
  early_prune: false
  early_stop_patience: 10
  metric: val/loss
  name: geotune-qokd9fqyuhxbgyyiuurpxu
  terratorch_task:
    freeze_backbone: false
    freeze_decoder: false
    ignore_index: -1
    loss: ce
    model_args:
      backbone: prithvi_eo_v2_300
      backbone_bands:
      - 0
      - 1
      - 2
      - 3
      - 4
      - 5
      backbone_drop_path: 0.1
      backbone_pretrained: true
      decoder: UNetDecoder
      decoder_channels:
      - 512
      - 256
      - 128
      - 64
      head_dropout: 0.1
      necks:
      - name: SelectIndices
        indices:
        - 5
        - 11
        - 17
        - 23
      - name: ReshapeTokensToImage
      - name: LearnedInterpolateToPyramidal
      num_classes: 3
    model_factory: EncoderDecoderFactory
    plot_on_val: 2
    tiled_inference_parameters:
      average_patches: false
      h_crop: 224
      h_stride: 196
      w_crop: 224
      w_stride: 196
  type: segmentation
